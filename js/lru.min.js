$(function(){var e={},t={},n={insNext:null,insCur:null,usage:null},r={pages:[],pageCapacity:4,pageMissing:0,huntCount:0},i={$console:$("#console"),$pageMissing:$("#page-missing"),$nextIns:$("#next-ins"),pages:[]},s={insCount:320,probJump:.1};e.makeArray=function(e,t){var n=[];while(t)n[--t]=e;return n};n._nextUnused=function(){var e=n.insCur+1;for(;e<s.insCount;e++)if(!n.usage[e])return e;return null};n._lastUnused=function(){var e=n.insCur-1;for(;e>=0;e--)if(!n.usage[e])return e;return null};n.findArb=function(){var e=Math.floor(Math.random()*320);return n.usage[e]?n._lastUnused(e)||n._nextUnused(e):e};t.shouldJump=function(){return Math.random()<s.probJump};t._genInsJumpNext=function(){return n.findArb()};t._genInsNext=function(){return n.insCur+1};t.genInsNext=function(){if(n.insCur===null){n.insNext=0;return}var e=n._lastUnused(),r=n._nextUnused();if(e===null&&r===null){n.insNext=-1;return}var i=t.shouldJump()||r!==n.insCur+1;i?n.insNext=t._genInsJumpNext():n.insNext=t._genInsNext()};t.hunt=function(){var e=r.pageOf(n.insCur);r.hunt(e)};t.run=function(){n.insCur=n.insNext;n.usage[n.insCur]=!0;i.outputConsole("准备载入【指令"+n.insCur+"】");r.hunt(r.pageOf(n.insCur));t.genInsNext();i.setInsNext();n.insNext!==-1&&setTimeout(t.run,20)};r.pageOf=function(e){return Math.floor(e/10)};r.hasPage=function(e){for(var t=0;t<r.pageCapacity;t++)if(!!r.pages[t]&&r.pages[t].num===e)return!0;return!1};r.getPageSize=function(){var e=0;for(var t=0;t<r.pageCapacity;t++)!r.pages[t]||e++;return e};r.getOutIndex=function(){var e=r.pages[0],t=0;for(var n=1;n<r.pageCapacity;n++)if(r.pages[n].timestamp<e.timestamp){e=r.pages[n];t=n}return t};r.hunt=function(e){r.huntCount++;i.outputConsole("查找页面"+e);if(!r.hasPage(e)){i.outputConsole("发生缺页");r.pageMissing++;var t=r.getPageSize(),n;t<r.pageCapacity?n=t:n=r.getOutIndex();r.pages[n]={num:e,timestamp:new Date};i.outputConsole("页面已经调到内存空间"+n);i.setPage(n,e)}else{r.touchPage(e);i.outputConsole("无缺页发生")}i.setPageMissing()};r.touchPage=function(e){var t=r.getPageIndex(e);!t||(r.pages[t].timestamp=new Date)};r.getPageIndex=function(e){for(var t=0;t<r.pageCapacity;t++)if(!!r.pages[t]&&r.pages[t].num===e)return t;return null};i.outputConsole=function(e){i.$console.val(e+"\n"+i.$console.val())};i.init=function(){for(var e=0;e<r.pageCapacity;e++)i.pages[e]=$("#page-"+e)};i.setPage=function(e,t){i.pages[e].find(".pid").text(t);i.pages[e].find(".range").text(t*10+" ~ "+(t*10+9))};i.setPageMissing=function(){i.$pageMissing.text(r.pageMissing+"/"+r.huntCount+" = "+r.pageMissing*100/r.huntCount)};i.setInsNext=function(){i.$nextIns.text(n.insNext)};i.init();n.usage=e.makeArray(!1,s.insCount);t.genInsNext();i.setInsNext();$("#btn-run").click(function(e){e.preventDefault();$(this).attr("disabled",!0);t.run()})});